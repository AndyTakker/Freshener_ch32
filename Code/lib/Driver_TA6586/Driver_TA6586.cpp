// Управление двигателем постоянного тока, приводом каретки рейсмуса.

#include <Driver_TA6586.h>

Driver::Driver(PinName pinDriverFw, PinName pinDriverRw) {
    pinFw = pinDriverFw;
    pinRw = pinDriverRw;

    // Настроим порты
    pinMode(pinFw, GPIO_Mode_Out_PP);
    pinMode(pinRw, GPIO_Mode_Out_PP);
    
    stop();      // Отключим питание двигателя
}

//==============================================================================
// Включение двигателя на движение вперед
//------------------------------------------------------------------------------
void Driver::forward(void) {
    pinWrite(pinFw, HIGH);
    pinWrite(pinRw, LOW);
    state = Forward;
}

//==============================================================================
// Включение двигателя на движение назад
//------------------------------------------------------------------------------
void Driver::reward(void) {
    pinWrite(pinFw,LOW);
    pinWrite(pinRw, HIGH);
    state = Reward;
}

//==============================================================================
// Выключение двигателя (снятие питания)
//------------------------------------------------------------------------------
void Driver::stop(void){
   pinWrite(pinFw, LOW);  
   pinWrite(pinRw, LOW);  
   state = Stopped;
}

//==============================================================================
// Торможение двигателя и затем - отключение
//------------------------------------------------------------------------------
void Driver::braking(void){
    pinWrite(pinFw, HIGH);
    pinWrite(pinRw, HIGH);
    state = Braking;
    delay(BRAKING_DELAY);
    stop();
}

//==============================================================================
// Вернуть текущий статус двигателя
//------------------------------------------------------------------------------
drvState Driver::getState(void) {
    return state;
}
